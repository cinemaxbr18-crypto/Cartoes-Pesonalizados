<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Cart√£o Animado</title>
    
    <style>
        /* --- FONTES EXTERNAS (Mais op√ß√µes) --- */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Playfair+Display:wght@700&family=Pacifico:wght@400&family=Lato:wght@400;700&family=Monoton&family=Chakra+Petch:wght@700&family=Inter:wght@400;700;800&display=swap');

        /* O Keyframes ser√° injetado pelo JavaScript (JS), mas precisamos de uma classe base */
        .is-blinking {
            animation-duration: 1.5s;
            animation-iteration-count: infinite;
            animation-name: color-blink-animacao; 
        }
        
        /* --- ANIMA√á√ïES GLOBAIS DE FUNDO --- */
        
        /* Anima√ß√£o gen√©rica do gradiente do BODY */
        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Anima√ß√£o Pulsante para o Natal (simula pisca-pisca) */
        @keyframes natalPulse {
            0% { box-shadow: 0 0 15px 5px rgba(255, 0, 0, 0.5); }
            50% { box-shadow: 0 0 30px 10px rgba(0, 255, 0, 0.7); }
            100% { box-shadow: 0 0 15px 5px rgba(255, 0, 0, 0.5); }
        }

        /* --- ESTILOS GLOBAIS E FUNDO --- */
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px 10px;
            margin: 0;
            
            /* Vari√°veis e anima√ß√µes para o fundo do body (configuradas no JS) */
            background-color: var(--fundo-body-cor, #f0f4f7); 
            background-image: var(--fundo-body-gradiente, none);
            background-size: 400% 400%; 
            animation: var(--body-animation, moveGradient 15s ease infinite); 
            transition: background-color 0.5s;
        }

        /* --- ESTILO DO CART√ÉO PRINCIPAL (Adaptativo) --- */
        .card-container {
            width: 100%;
            max-width: 450px;
        }

        .card {
            background-color: var(--fundo-card-cor, white);
            border: 1px solid #e5e7eb; 
            border-radius: 1rem; 
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            padding: 1.5rem 1rem;
            margin-bottom: 1.25rem; 
            text-align: center;
            border-bottom: 7px solid var(--borda-cor, #c0c0c0);
            min-height: 300px; 
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            
            /* Fundo do Card com Imagem Tem√°tica */
            background-image: var(--fundo-card-imagem, none);
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay; 
            transition: background-image 0.5s, box-shadow 0.5s;
        }

        /* --- ELEMENTOS DE TEXTO DO CART√ÉO --- */
        #saudacaoPersonalizada {
            color: #4b5563; 
            margin-bottom: 0.75rem;
            font-size: 1.125rem;
        }

        .nome-destaque {
            font-weight: 700;
            color: #d9534f; 
            font-size: 1.8em;
            line-height: 1.2;
            display: block;
        }

        #eventoNome {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--titulo-cor, #004d99);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-top: 0.5rem;
            margin-bottom: 0.75rem;
            font-family: var(--fonte-estilo, 'Inter', sans-serif);
            line-height: 1.1;
            transition: all 0.5s;
        }

        #contagemRegressiva {
            font-size: 1.4rem;
            color: #5cb85c; 
            font-weight: 700;
            background-color: #f3f4f6;
            padding: 0.6rem;
            border-radius: 0.6rem;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            transition: all 0.5s;
        }

        .mensagem-principal {
            color: var(--mensagem-cor, #374151);
            font-size: 1.05rem;
            border-top: 1px solid var(--borda-cor-separador, #e5e7eb);
            padding-top: 1rem;
            margin-top: 1rem;
            white-space: pre-wrap;
            flex-grow: 1;
        }
        
        /* Estilos espec√≠ficos para o elemento piscando (borda) */
        .blinking-borda {
             border-bottom: 7px solid var(--borda-cor, #c0c0c0); 
             animation: border-blink-animacao 1.5s infinite;
        }

        /* --- SLIDESHOW / GALERIA DE FOTOS --- */
        .galeria-container {
            position: relative;
            width: 100%;
            height: 150px; /* Altura fixa para o slideshow */
            margin-top: 1.5rem;
            overflow: hidden;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .galeria-imagem {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* Garante que a imagem preencha o espa√ßo sem distor√ß√£o */
            opacity: 0;
            transition: opacity 1.5s ease-in-out; /* Transi√ß√£o suave */
        }
        
        .galeria-imagem.active {
            opacity: 1;
        }

        /* --- CONTROLES DE PERSONALIZA√á√ÉO --- */
        .secao-personalizacao {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 10px;
        }
        
        .secao-opcoes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        /* Ajuste para grids com 3 colunas para cores */
        .secao-cores {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 1rem;
            margin-top: 10px;
        }
        
        .secao-fundo {
             display: grid;
            grid-template-columns: repeat(2, 1fr); 
            gap: 1rem;
        }
        
        /* Ajuste para grids com 1 coluna para URLs longas */
        .secao-urls {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 1rem;
        }


        label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #4b5563;
            margin-bottom: 0.25rem;
        }
        
        input[type="text"], input[type="date"], #linkGerado, select, textarea {
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            border: 1px solid #d1d5db;
            transition: border-color 0.2s;
            background-color: #fff;
            width: 100%;
            box-sizing: border-box;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }

        /* Estiliza√ß√£o para inputs de cor */
        input[type="color"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 100%;
            height: 40px;
            padding: 0;
            border: none;
            cursor: pointer;
            border-radius: 0.5rem;
        }

        button {
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .botao-ver {
            background-color: #2563eb; 
            color: white;
        }
        .botao-ver:hover {
            background-color: #1d4ed8;
            transform: translateY(-1px);
        }
        
        .botao-whatsapp {
            background-color: #10b981; 
            margin-top: 0.625rem;
        }
        .botao-whatsapp:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }
        
        .botao-copiar {
            background-color: #10b981; 
        }

        /* --- CAIXA DE MENSAGEM CUSTOMIZADA --- */
        #messageBox {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            display: none;
            max-width: 80%;
        }

        #linkContainer {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        /* --- ESTILOS DOS BOT√ïES DE COMPARTILHAMENTO --- */
        .share-buttons-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 colunas iguais */
            gap: 10px; /* Espa√ßamento entre os bot√µes */
        }

        .botao-compartilhar {
            padding: 0.8rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
            color: white; /* Cor do texto padr√£o para todos */
            display: flex; /* Para alinhar o √≠cone e o texto */
            align-items: center; /* Alinha verticalmente */
            justify-content: center; /* Centraliza horizontalmente */
            gap: 5px; /* Espa√ßamento entre o √≠cone e o texto */
        }
        .botao-compartilhar:hover {
             opacity: 0.9;
             transform: translateY(-1px);
        }

        .share-icon {
            height: 1.2em; /* Tamanho do √≠cone relativo ao tamanho da fonte do bot√£o */
            width: 1.2em;
            vertical-align: middle; /* Alinha o √≠cone com o texto */
            filter: brightness(0) invert(1); /* Torna o √≠cone branco para melhor contraste */
        }

        .botao-compartilhar.whatsapp {
            background-color: #25d366; /* Cor oficial do WhatsApp */
        }
        
        .botao-compartilhar.facebook {
            background-color: #1877f2; /* Cor oficial do Facebook */
        }
        
        .botao-compartilhar.instagram {
            /* Simula um gradiente Instagram */
            background-image: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); 
        }

        .botao-copiar { /* Estilo para o bot√£o COPIAR COMPLETO */
            background-color: #6c757d; 
            color: white;
            font-weight: 600;
        }
        .botao-copiar:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
        }
        
        /* --- ESTILOS DO NOVO POP-UP (MODAL) --- */
        #newsModal {
            position: fixed;
            z-index: 1001; /* Acima de tudo */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7); /* Fundo escuro */
            display: none; /* Escondido por padr√£o */
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto; /* Centraliza verticalmente e horizontalmente com flex */
            padding: 30px;
            border-radius: 10px;
            border-top: 5px solid #00bcd4;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        
        .modal-content h3 {
            color: #00bcd4;
            margin-top: 0;
            font-size: 1.6rem;
        }
        
        .modal-content p {
            color: #555;
            margin-bottom: 20px;
        }

        .modal-content a.button-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: #00bcd4;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        
        .modal-content a.button-link:hover {
            background-color: #0097a7;
        }
        /* --- FIM DOS ESTILOS DO POP-UP --- */
        
        
        /* --- REMOVEMOS O BOT√ÉO DO CART√ÉO, POIS AGORA TEREMOS O POP-UP --- */
        .botao-novidades {
            display: none; 
        }

        /* Estilo para a se√ß√£o de Copyright */
        .copyright {
            margin-top: 20px;
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
        }

        /* Esconder os controles no modo de visualiza√ß√£o */
        .modo-visualizacao #controles {
            display: none;
        }
        
        /* --- ESTILOS PARA O GUIA DE LINKS --- */
        .guide-link-section {
            text-align: center;
            margin: 10px 0;
        }
        .guide-link {
            color: #d9534f; /* Vermelho de Alerta */
            font-weight: 700;
            text-decoration: none;
            border-bottom: 2px dashed #d9534f;
            padding-bottom: 2px;
            transition: color 0.2s;
            display: inline-block;
            font-size: 0.9em; /* Para n√£o ficar muito grande */
        }
        .guide-link:hover {
            color: #ff0000;
        }
        
    </style>
    <style id="dynamic-animation-style"></style>
</head>
<body class="flex flex-col items-center">

    <div id="newsModal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" onclick="fecharNovidades()">√ó</span>
            <h3>üîî GRANDES NOVIDADES!</h3>
            <p>Implementamos recursos incr√≠veis, como Galeria de Fotos (Slideshow), Mais Fontes e Anima√ß√µes Pisca-Pisca!</p>
            <a href="novidades.html" class="button-link" target="_blank" onclick="fecharNovidades()">
                Ver Detalhes Agora
            </a>
            <p style="font-size: 0.8em; color: #888; margin-top: 15px;">Feche esta janela ou aguarde 5 segundos.</p>
        </div>
    </div>
    <div id="messageBox" class="text-lg"></div>

    <div class="card-container">
        <div class="card" id="cartao">
            <div id="saudacaoPersonalizada">desejando voc√™</div>
            
            <div id="eventoNome">FELIZ NATAL</div>
            
            <div id="contagemRegressiva">Contando...</div>

            <div id="mensagemPrincipal" class="mensagem-principal">
                Que Deus te aben√ßoe com muita paz e alegria neste dia!
                
                </div>

            <div id="galeriaContainer" class="galeria-container" style="display:none;">
                </div>
        </div>
    </div>

    <div class="secao-personalizacao" id="controles">
        <h3 class="text-xl font-bold text-gray-800 border-b pb-2">‚ú® Personalize Conte√∫do e Estilo</h3>
        
        <div class="input-group">
            <label for="nomeInput">Seu Nome:</label>
            <input type="text" id="nomeInput" placeholder="Seu nome" value="Seu Nome" maxlength="20" oninput="atualizarAlvo()">
        </div>
        
        <div class="secao-opcoes">
            <div class="input-group">
                <label for="dataAlvoInput">Data do Evento:</label>
                <input type="date" id="dataAlvoInput" onchange="atualizarAlvo()">
            </div>
            
            <div class="input-group">
                <label for="eventoInput">Nome do Evento (T√≠tulo Principal):</label>
                <input type="text" id="eventoInput" placeholder="Ex: FELIZ ANO NOVO" value="FELIZ NATAL" maxlength="25" oninput="atualizarAlvo()">
            </div>
        </div>
        
        <div class="input-group">
            <label for="mensagemTexto">Texto da Mensagem (pode usar quebras de linha):</label>
            <textarea id="mensagemTexto" rows="3" oninput="atualizarAlvo()">Que Deus te aben√ßoe com muita paz e alegria neste dia!</textarea>
        </div>

        <h4 class="text-lg font-bold text-gray-700 border-t pt-3 mt-3">üé® Estilos e Anima√ß√£o</h4>
        
        <div class="input-group">
            <label for="fonteInput">Estilo da Fonte do T√≠tulo:</label>
            <select id="fonteInput" onchange="aplicarEstilos()">
                <option value="Inter, sans-serif">Padr√£o (Inter)</option>
                <option value="'Roboto', sans-serif">Roboto (Cl√°ssica)</option>
                <option value="'Playfair Display', serif">Playfair Display (Elegante)</option>
                <option value="'Pacifico', cursive">Pacifico (Manuscrita)</option>
                <option value="'Monoton', cursive">Monoton (Vibrante)</option>
                <option value="'Lato', sans-serif">Lato (Simples/Profissional)</option>
                <option value="'Chakra Petch', sans-serif">Chakra Petch (Tecnol√≥gico)</option>
            </select>
        </div>

        <div class="secao-cores">
            <div class="input-group">
                <label for="corTitulo">Cor do T√≠tulo:</label>
                <input type="color" id="corTitulo" value="#004d99" oninput="aplicarEstilos()">
            </div>
            <div class="input-group">
                <label for="corMensagem">Cor da Mensagem:</label>
                <input type="color" id="corMensagem" value="#374151" oninput="aplicarEstilos()">
            </div>
            <div class="input-group">
                <label for="corBorda">Borda (Cor Fixa):</label>
                <input type="color" id="corBorda" value="#c0c0c0" oninput="aplicarEstilos()">
            </div>
        </div>
        <div class="secao-fundo">
             <div class="input-group">
                <label for="corFundoCard">Fundo do Cart√£o (Cor):</label>
                <input type="color" id="corFundoCard" value="#ffffff" oninput="aplicarEstilos()">
            </div>
             <div class="input-group">
                <label for="corFundoBody">Fundo da P√°gina (Cor):</label>
                <input type="color" id="corFundoBody" value="#f0f4f7" oninput="aplicarEstilos()">
            </div>
        </div>
        
        <h4 class="text-lg font-bold text-gray-700 border-t pt-3 mt-3">‚ö° Anima√ß√£o Pisca-Pisca</h4>
        
        <div class="input-group">
            <label for="elementoPiscar">Elemento que Pisca:</label>
            <select id="elementoPiscar" onchange="aplicarEstilos()">
                <option value="none">Nenhum</option>
                <option value="titulo">T√≠tulo Principal</option>
                <option value="contagem">Contagem Regressiva</option>
                <option value="borda">Borda (Cor Alternada)</option>
            </select>
        </div>

        <div class="secao-cores">
            <div class="input-group">
                <label for="corPiscar1">Cor Principal (1):</label>
                <input type="color" id="corPiscar1" value="#ff0000" oninput="aplicarEstilos()">
            </div>
            <div class="input-group">
                <label for="corPiscar2">Cor Alternada (2):</label>
                <input type="color" id="corPiscar2" value="#00ff00" oninput="aplicarEstilos()">
            </div>
        </div>

        <h4 class="text-lg font-bold text-gray-700 border-t pt-3 mt-3">üñºÔ∏è Galeria de Fotos (Slideshow)</h4>
        
        <p class="guide-link-section">
            <a href="https://cinemaxbr18-crypto.github.io/guiar-de-imagens/" target="_blank" class="guide-link">
                ‚ö†Ô∏è CLIQUE AQUI SE SUAS FOTOS N√ÉO ESTIVEREM APARECENDO (Guia de Links)
            </a>
        </p>
        
        <div class="secao-urls">
            <div class="input-group">
                <label for="urlsInput">URLs das Imagens (Separe por ponto e v√≠rgula `;`):</label>
                <textarea id="urlsInput" rows="3" placeholder="Cole aqui links da internet ou links de compartilhamento do Google Drive" oninput="atualizarAlvo()"></textarea>
            </div>
        </div>
        <h4 class="text-lg font-bold text-gray-700 border-t pt-3 mt-3">üñºÔ∏è Fundo da P√°gina (Cores Predefinidas)</h4>
        
        <div class="input-group">
            <label for="fundoBodySelect">Escolha a Cor de Fundo da P√°gina (Body):</label>
            <select id="fundoBodySelect" onchange="aplicarEstilosFundo()">
                <option value="#f0f4f7">Padr√£o Claro (Cinza Suave)</option>
                <option value="#8B4513">Marrom (Sela)</option>
                <option value="#1c1c1c">Preto (Escuro)</option>
                <option value="#ADD8E6">Azul Claro (C√©u)</option>
                <option value="#90EE90">Verde Claro</option>
                <option value="#ffffff">Branco Puro</option>
            </select>
        </div>
        <button class="botao-ver" onclick="atualizarAlvo()">
            PR√â-VISUALIZAR E ATUALIZAR
        </button>
        
        <button class="botao-whatsapp" onclick="gerarLinkECompartilhar()">
            GERAR LINK DE COMPARTILHAMENTO
        </button>

        <div id="linkContainer" style="display:none; margin-top: 1.5rem; border-top: 1px solid #e5e7eb; padding-top: 1rem;">
            <label for="linkGerado" style="font-size: 1.1rem; font-weight: 700;">üîó Link Gerado (Pronto para Compartilhar):</label>
            <input type="text" id="linkGerado" readonly style="margin-bottom: 10px; background-color: #f3f4f6;">
            
            <p style="font-size: 0.9em; color: #d9534f; margin: 5px 0 15px 0;">
                **Dica:** Para o Instagram/Stories, COPIE o link acima e cole manualmente.
            </p>

            <div class="share-buttons-grid">
                <button class="botao-compartilhar whatsapp" onclick="compartilharWhatsApp()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="share-icon">
                    WhatsApp
                </button>
                <button class="botao-compartilhar facebook" onclick="compartilharFacebook()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook" class="share-icon">
                    Facebook
                </button>
                 <button class="botao-compartilhar instagram" onclick="copiarLink()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg" alt="Instagram" class="share-icon">
                    Instagram
                </button>
            </div>
             <button class="botao-copiar" style="margin-top: 10px; background-color: #1a73e8;" onclick="copiarLink()">
                COPIAR LINK COMPLETO
            </button>
        </div>


        <div class="copyright">
            C√≥digo desenvolvido para uso pessoal. **Todos os direitos reservados a Geilson Carlos.**
        </div>
    </div>

    <script>
        // Vari√°veis globais
        window.countdownInterval = null;
        window.slideshowInterval = null; 
        
        // Vers√£o do conte√∫do de novidades. Mude este n√∫mero para reexibir o pop-up para todos.
        const NEWS_VERSION = 2; 

        // Fun√ß√£o para exibir mensagens na tela (substitui alert() e confirm())
        function showMessage(message, duration = 3000) {
            const msgBox = document.getElementById('messageBox');
            msgBox.textContent = message;
            msgBox.style.display = 'block';
            setTimeout(() => {
                msgBox.style.display = 'none';
            }, duration);
        }

        // --- FUN√á√ïES DO POP-UP DE NOVIDADES ---

        /**
         * Exibe o pop-up de novidades ap√≥s um atraso, se ainda n√£o foi visto.
         */
        function exibirNovidadesAposAtraso() {
            const lastSeenVersion = localStorage.getItem('news_version_seen');

            // Verifica se a vers√£o atual √© a mesma da √∫ltima vista
            if (lastSeenVersion >= NEWS_VERSION) {
                return; // J√° viu esta vers√£o, n√£o exibe
            }

            // Exibe o modal 5 segundos ap√≥s o carregamento
            setTimeout(() => {
                const modal = document.getElementById('newsModal');
                if (modal) {
                    modal.style.display = 'flex';
                }
            }, 5000); // 5 segundos de atraso
        }

        /**
         * Fecha o pop-up e marca a vers√£o atual como vista.
         */
        function fecharNovidades() {
            const modal = document.getElementById('newsModal');
            if (modal) {
                modal.style.display = 'none';
                // Salva a vers√£o atual como vista no localStorage
                localStorage.setItem('news_version_seen', NEWS_VERSION);
            }
        }
        
        // --- FIM DAS FUN√á√ïES DO POP-UP DE NOVIDADES ---


        /**
         * FUN√á√ÉO CR√çTICA: Converte links de compartilhamento populares (Drive, ImgBB Viewer)
         * para links diretos de embed ou imagem pura.
         */
        function converterLinkImagem(url) {
            // Remove espa√ßos em branco
            let urlLimpa = url.trim();

            // 1. REGRA GOOGLE DRIVE (Mais robusta, prioridade alta)
            const driveShareRegex = /drive\.google\.com\/(?:file\/d|open\?id=|uc\?export=download&id=)([^&/]+)/i;
            const driveMatch = urlLimpa.match(driveShareRegex);
            if (driveMatch && driveMatch[1]) {
                const fileId = driveMatch[1];
                return `https://drive.google.com/uc?export=view&id=${fileId}`; // Formato de embed
            }
            
            // 2. REGRA IMGBB (Converte link da p√°gina de visualiza√ß√£o para link direto)
            // Tenta converter ibb.co/ID para i.ibb.co/ID/
            const ibbViewerRegex = /^https?:\/\/(?:www\.)?ibb\.co\/([a-zA-Z0-9]+)$/i;
            const ibbMatch = urlLimpa.match(ibbViewerRegex);
            if (ibbMatch) {
                // Tentativa de convers√£o para o formato de link direto
                showMessage("‚ö†Ô∏è O link do ImgBB foi reconhecido como link de visualiza√ß√£o. O sistema tentar√° carregar o link direto, mas se a foto n√£o aparecer, voc√™ deve copiar o 'Link Direto' completo do ImgBB.", 6000);
                return `https://i.ibb.co/${ibbMatch[1]}/`; // Assume que o ID √© o suficiente para o caminho
            }
            
            // 3. REGRA IMAGEM PURA (Se j√° for um link direto v√°lido)
            // Se o link termina em uma extens√£o de imagem comum ou for um link i.ibb.co
            if (urlLimpa.match(/\.(jpe?g|png|gif|webp|bmp|svg)$/i) || urlLimpa.includes('i.ibb.co') || urlLimpa.includes('imgur.com/')) {
                return urlLimpa;
            }

            // Se for um link de visualiza√ß√£o ImgBB n√£o convertido OU qualquer outro link que n√£o foi reconhecido.
            if (urlLimpa.includes('ibb.co')) {
                // Mensagem de aviso mais espec√≠fica
                showMessage(`O link do ImgBB (${urlLimpa}) √© um Link de Visualiza√ß√£o. Por favor, tente selecionar a op√ß√£o 'Link Direto' no ImgBB ou cole uma URL que termine em .jpg ou .png.`, 5000);
            }
            
            // Retorna o original se n√£o houver correspond√™ncia (e o erro ser√° tratado pelo img.onerror)
            return urlLimpa;
        }

        /**
         * Inicia ou reinicia o slideshow de fotos
         */
        function iniciarSlideshow(urls) {
            const galeria = document.getElementById('galeriaContainer');
            
            // 1. Limpa o cont√™iner e o intervalo anterior
            galeria.innerHTML = '';
            clearInterval(window.slideshowInterval);

            if (!urls || urls.length === 0 || urls.every(url => url.trim() === '')) {
                // N√£o h√° URLs v√°lidas, apenas limpa e sai
                galeria.style.display = 'none';
                return;
            }

            galeria.style.display = 'block';
            let currentIndex = 0;

            // 2. Cria os elementos <img> no DOM
            urls.forEach((url, index) => {
                const img = document.createElement('img');
                img.src = url.trim();
                img.className = 'galeria-imagem';
                
                // NOVO: Tratamento de erro de carregamento 
                img.onerror = function() {
                    console.error(`Falha ao carregar a imagem, verifique as permiss√µes de compartilhamento do Drive/link ImgBB: ${this.src}`);
                };
                
                // Define a primeira imagem como ativa
                if (index === 0) {
                    img.classList.add('active');
                }
                galeria.appendChild(img);
            });

            const imagens = document.querySelectorAll('.galeria-imagem');

            // 3. Fun√ß√£o de transi√ß√£o
            function nextSlide() {
                // Remove a classe 'active' da imagem atual
                if (imagens[currentIndex]) {
                    imagens[currentIndex].classList.remove('active');
                }
                
                // Avan√ßa para a pr√≥xima imagem (ou volta para a primeira)
                currentIndex = (currentIndex + 1) % imagens.length;
                
                // Adiciona a classe 'active' na nova imagem
                if (imagens[currentIndex]) {
                    imagens[currentIndex].classList.add('active');
                }
            }
            
            // 4. Inicia o loop (alterna a cada 4 segundos)
            window.slideshowInterval = setInterval(nextSlide, 4000); 
        }


        /**
         * Seleciona a imagem de fundo do card e o gradiente do body com base no tema do evento
         */
        function selecionarFundoTematico(evento) {
            const lowerEvent = evento.toLowerCase();
            const card = document.getElementById('cartao');
            
            let cardImage = 'none';
            let bodyGradient = 'none';
            let bodyAnimation = 'moveGradient 15s ease infinite'; 
            
            let bodyColor = document.getElementById('corFundoBody').value; 

            // Se a cor do corpo for diferente do padr√£o
            const isDefaultColor = bodyColor === '#f0f4f7';

            if (!isDefaultColor) {
                 // Cor customizada ou do select, ent√£o anula o tema de gradiente/anima√ß√£o
                 card.style.animation = 'none';
            } else {
                 // --- TEMAS (Somente se a cor n√£o foi customizada) ---
                if (lowerEvent.includes('natal')) {
                    cardImage = 'url(https://placehold.co/450x300/a30000/ffffff?text=BOLAS+DE+NATAL)';
                    bodyGradient = 'linear-gradient(135deg, #b30000 0%, #006600 100%)';
                    bodyAnimation = 'moveGradient 10s ease infinite';
                    bodyColor = '#b30000';
                    card.style.animation = 'natalPulse 4s ease-in-out infinite'; 

                } else if (lowerEvent.includes('ano novo') || lowerEvent.includes('anonovo')) {
                    cardImage = 'url(https://placehold.co/450x300/000000/ffd700?text=FOGOS+DE+ARTIFICIO)';
                    bodyGradient = 'linear-gradient(135deg, #1c1c1c 0%, #ffcc00 50%, #1c1c1c 100%)';
                    bodyAnimation = 'moveGradient 5s linear infinite';
                    bodyColor = '#1c1c1c';
                    card.style.animation = 'none'; 

                } else if (lowerEvent.includes('anivers√°rio') || lowerEvent.includes('aniversario')) {
                    cardImage = 'url(https://placehold.co/450x300/e91e63/ffeb3b?text=BALOES+E+CONFETE)';
                    bodyGradient = 'linear-gradient(135deg, #e91e63 0%, #9c27b0 100%)';
                    bodyAnimation = 'moveGradient 12s ease infinite';
                    bodyColor = '#e91e63';
                    card.style.animation = 'none'; 

                } else if (lowerEvent.includes('bom dia')) {
                    cardImage = 'url(https://placehold.co/450x300/87ceeb/ffd700?text=CEU+AZUL+E+SOL)';
                    bodyGradient = 'linear-gradient(135deg, #ffeb3b 0%, #87ceeb 100%)';
                    bodyAnimation = 'moveGradient 20s ease infinite';
                    bodyColor = '#ffeb3b';
                    card.style.animation = 'none'; 

                } else if (lowerEvent.includes('boa noite') || lowerEvent.includes('boanoite')) {
                    cardImage = 'url(https://placehold.co/450x300/1a1a2e/ffffff?text=NOITE+ESTRELADA)';
                    bodyGradient = 'linear-gradient(135deg, #1a1a2e 0%, #3a0050 100%)';
                    bodyAnimation = 'moveGradient 18s ease infinite';
                    bodyColor = '#1a1a2e';
                    card.style.animation = 'none'; 

                } else {
                    // Tema Padr√£o 
                    cardImage = 'none';
                    bodyGradient = 'linear-gradient(135deg, #f0f4f7 0%, #e0eaf1 100%)';
                    bodyAnimation = 'moveGradient 15s ease infinite';
                    bodyColor = '#f0f4f7';
                    card.style.animation = 'none'; 
                }
            }

            // Aplica os estilos no DOM
            document.body.style.backgroundImage = bodyGradient;
            document.body.style.backgroundColor = bodyColor;
            document.body.style.setProperty('--body-animation', bodyAnimation);
            card.style.backgroundImage = cardImage;
        }


        /**
         * Fun√ß√µes de Estiliza√ß√£o e Anima√ß√£o
         */
        
        function injectDynamicAnimationCSS(cor1, cor2, elementoPiscar) {
            const styleElement = document.getElementById('dynamic-animation-style');
            let css = '';
            
            // 1. Anima√ß√£o de cor para T√≠tulo e Contagem (Text-Color)
            css += `@keyframes color-blink-animacao {
                0%, 100% { color: ${cor1}; }
                50% { color: ${cor2}; }
            }`;

            // 2. Anima√ß√£o de cor para a Borda (Border-Color)
            css += `@keyframes border-blink-animacao {
                0%, 100% { border-bottom-color: ${cor1}; }
                50% { border-bottom-color: ${cor2}; }
            }`;
            
            styleElement.textContent = css;
        }
        
        // Fun√ß√£o para aplicar estilos de fundo a partir do select
        function aplicarEstilosFundo() {
            const fundoBodySelect = document.getElementById('fundoBodySelect').value;
            const corFundoBodyInput = document.getElementById('corFundoBody');
            
            // 1. Sincroniza o input[type=color] com o valor selecionado
            corFundoBodyInput.value = fundoBodySelect;

            // 2. Aplica a cor de fundo do Body (p√°gina)
            document.body.style.backgroundColor = fundoBodySelect;
            document.body.style.setProperty('--fundo-body-cor', fundoBodySelect);
            
            // 3. Reseta gradiente e anima√ß√£o para garantir que a cor s√≥lida funcione
            document.body.style.backgroundImage = 'none';
            document.body.style.setProperty('--fundo-body-gradiente', 'none');
            document.body.style.setProperty('--body-animation', 'none');
            
            showMessage(`Fundo da p√°gina alterado para a cor selecionada.`, 1500);
        }

        function aplicarEstilos() {
            const titulo = document.getElementById('eventoNome');
            const mensagem = document.getElementById('mensagemPrincipal');
            const cartao = document.getElementById('cartao');
            
            // 1. Estilos Est√°ticos (Cores e Fontes)
            const fonte = document.getElementById('fonteInput').value;
            const corTitulo = document.getElementById('corTitulo').value;
            const corMensagem = document.getElementById('corMensagem').value;
            const corBorda = document.getElementById('corBorda').value;
            const corFundoCard = document.getElementById('corFundoCard').value;
            const corFundoBody = document.getElementById('corFundoBody').value; // Cor do input[type=color]

            titulo.style.fontFamily = fonte;
            
            // Aplica as vari√°veis CSS
            document.documentElement.style.setProperty('--titulo-cor', corTitulo);
            document.documentElement.style.setProperty('--mensagem-cor', corMensagem);
            document.documentElement.style.setProperty('--borda-cor', corBorda);
            document.documentElement.style.setProperty('--fonte-estilo', fonte);
            document.documentElement.style.setProperty('--fundo-card-cor', corFundoCard);
            document.documentElement.style.setProperty('--fundo-body-cor', corFundoBody);
            
            // Aplica estilos diretamente para o body/card
            document.body.style.backgroundColor = corFundoBody;
            cartao.style.backgroundColor = corFundoCard;
            
            // 2. Anima√ß√£o Pisca-Pisca
            const elementoPiscar = document.getElementById('elementoPiscar').value;
            const corPiscar1 = document.getElementById('corPiscar1').value;
            const corPiscar2 = document.getElementById('corPiscar2').value;
            
            // Remove todas as classes de anima√ß√£o antes de aplicar a nova
            titulo.classList.remove('is-blinking');
            document.getElementById('contagemRegressiva').classList.remove('is-blinking');
            cartao.classList.remove('blinking-borda');
            cartao.style.animation = 'none'; // Reseta anima√ß√£o de pulso

            // Injeta o CSS din√¢mico (keyframe)
            injectDynamicAnimationCSS(corPiscar1, corPiscar2, elementoPiscar);
            
            // Aplica a classe de anima√ß√£o no elemento correto
            if (elementoPiscar === 'titulo') {
                titulo.classList.add('is-blinking');
            } else if (elementoPiscar === 'contagem') {
                document.getElementById('contagemRegressiva').classList.add('is-blinking');
            } else if (elementoPiscar === 'borda') {
                cartao.classList.add('blinking-borda');
            }
            
            // Se o seletor de fundo predefinido estiver ativo, o CSS s√≥lido ser√° aplicado novamente.
            if (document.getElementById('fundoBodySelect').value !== document.getElementById('fundoBodySelect').options[0].value) {
                aplicarEstilosFundo();
            }
        }

        /**
         * Fun√ß√£o principal de contagem regressiva
         */
        function atualizarContagem(dataAlvo) {
            clearInterval(window.countdownInterval); 

            function calcularTempo() {
                const agora = new Date().getTime();
                const diferenca = dataAlvo - agora;

                const contagemElemento = document.getElementById('contagemRegressiva');

                if (diferenca < 0) {
                    contagemElemento.textContent = "ü•≥ O Evento Come√ßou/Passou! ü•≥";
                    clearInterval(window.countdownInterval);
                    return;
                }

                const totalSegundos = Math.floor(diferenca / 1000);
                const dias = Math.floor(totalSegundos / (60 * 60 * 24));
                const horas = Math.floor((totalSegundos % (60 * 60 * 24)) / (60 * 60));
                const minutos = Math.floor((totalSegundos % (60 * 60)) / 60);
                const segundos = totalSegundos % 60;
                
                const meses = Math.floor(dias / 30);
                const diasRestantes = dias % 30;

                let textoContagem = "";
                
                if (dias >= 45) {
                    // Contagem em meses e dias
                     textoContagem = `${meses} m√™s${meses !== 1 ? 'es' : ''}, ${diasRestantes} dia${diasRestantes !== 1 ? 's' : ''}, ${horas}h, ${minutos}m, ${segundos}s antes`;
                } else if (dias >= 1) {
                    // Contagem em dias, horas, minutos e segundos
                    textoContagem = `${dias} dia${dias !== 1 ? 's' : ''}, ${horas}h, ${minutos}m, ${segundos}s antes`;
                } else {
                    // Contagem em horas, minutos e segundos (menos de 24h)
                    textoContagem = `${horas}h, ${minutos}m, ${segundos}s antes`;
                }
                
                contagemElemento.textContent = textoContagem;
            }

            calcularTempo(); // Roda imediatamente
            window.countdownInterval = setInterval(calcularTempo, 1000); // Roda a cada segundo
        }


        /**
         * Atualiza os elementos vis√≠veis do cart√£o baseado nos inputs e aplica estilos.
         */
        function atualizarAlvo() {
            const nome = document.getElementById('nomeInput').value || "Algu√©m";
            const dataStr = document.getElementById('dataAlvoInput').value;
            const evento = document.getElementById('eventoInput').value || "EVENTO ESPECIAL";
            const mensagem = document.getElementById('mensagemTexto').value || "Uma mensagem de carinho para voc√™!";
            
            // 1. Coleta URLs e as prepara
            const urlsBrutas = document.getElementById('urlsInput').value;
            
            let urlsArray = [];
            if (urlsBrutas) {
                // Separa os links por ponto e v√≠rgula, remove espa√ßos e filtra vazios
                urlsArray = urlsBrutas.split(';')
                    .map(url => url.trim())
                    .filter(url => url !== '')
                    // Convers√£o autom√°tica: tenta converter o link (Drive ou ImgBB)
                    .map(url => converterLinkImagem(url)); 
            }


            const saudacao = document.getElementById('saudacaoPersonalizada');
            const eventoNome = document.getElementById('eventoNome');
            const mensagemPrincipal = document.getElementById('mensagemPrincipal');

            // 2. Atualizar Conte√∫do
            saudacao.innerHTML = `<span class="nome-destaque">${nome.toUpperCase()}</span> desejando voc√™`;
            eventoNome.textContent = evento.toUpperCase();
            mensagemPrincipal.textContent = mensagem;

            // 3. Atualizar Contagem
            if (dataStr) {
                const dataAlvo = new Date(dataStr + "T00:00:00").getTime();
                atualizarContagem(dataAlvo);
            } else {
                document.getElementById('contagemRegressiva').textContent = "Selecione uma data no campo de Data do Evento";
                clearInterval(window.countdownInterval);
            }

            // 4. Aplicar Estilos e Temas
            aplicarEstilos();
            selecionarFundoTematico(evento);
            
            // 5. Iniciar Slideshow com os links convertidos/ajustados
            iniciarSlideshow(urlsArray);
        }

        /**
         * Gera o link de compartilhamento.
         */
        function gerarLink() {
            const nome = encodeURIComponent(document.getElementById('nomeInput').value);
            const data = encodeURIComponent(document.getElementById('dataAlvoInput').value);
            const evento = encodeURIComponent(document.getElementById('eventoInput').value);
            const mensagem = encodeURIComponent(document.getElementById('mensagemTexto').value);
            // Adiciona as URLs codificadas
            const urls = encodeURIComponent(document.getElementById('urlsInput').value);

            // Estilos
            const fonte = encodeURIComponent(document.getElementById('fonteInput').value);
            const corTitulo = encodeURIComponent(document.getElementById('corTitulo').value);
            const corMensagem = encodeURIComponent(document.getElementById('corMensagem').value);
            const corBorda = encodeURIComponent(document.getElementById('corBorda').value);
            const corFundoCard = encodeURIComponent(document.getElementById('corFundoCard').value);
            const corFundoBody = encodeURIComponent(document.getElementById('corFundoBody').value);
            const elementoPiscar = encodeURIComponent(document.getElementById('elementoPiscar').value);
            const corPiscar1 = encodeURIComponent(document.getElementById('corPiscar1').value);
            const corPiscar2 = encodeURIComponent(document.getElementById('corPiscar2').value);


            // Monta a URL base (assume que o arquivo est√° no index.html ou semelhante)
            const baseUrl = window.location.href.split('?')[0]; 

            const params = `?nome=${nome}&data=${data}&evento=${evento}&msg=${mensagem}&urls=${urls}` + 
                           `&ft=${fonte}&ct=${corTitulo}&cm=${corMensagem}&cb=${corBorda}&cfc=${corFundoCard}&cfb=${corFundoBody}` +
                           `&ep=${elementoPiscar}&cp1=${corPiscar1}&cp2=${corPiscar2}`;

            return baseUrl + params;
        }
        
        /**
         * Gera o link e prepara a exibi√ß√£o dos bot√µes.
         */
        function gerarLinkECompartilhar() {
             const link = gerarLink();
             
             document.getElementById('linkGerado').value = link;
             document.getElementById('linkContainer').style.display = 'flex';
             
             showMessage("Link gerado! Escolha a plataforma para compartilhar.", 4000);
        }

        /**
         * Compartilha o link no WhatsApp com mensagem formatada.
         */
        function compartilharWhatsApp() {
            const link = document.getElementById('linkGerado').value;
            const evento = document.getElementById('eventoInput').value;
            const nome = document.getElementById('nomeInput').value;
            
            // Mensagem no formato WhatsApp (usando * para negrito e \n para quebra de linha)
            const mensagem = 
                `ü•≥ Ol√°! *${nome.toUpperCase()}* te enviou um cart√£o animado para o evento: *${evento.toUpperCase()}*!\n\n` +
                `‚ú® *Clique no link abaixo* e veja a surpresa feita especialmente para voc√™:\n` +
                `${link}\n\n` +
                `_Compartilhe esta alegria!_`;
            
            // Link de inten√ß√£o para WhatsApp
            const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(mensagem)}`;
            
            window.open(whatsappUrl, '_blank');
        }

        /**
         * Compartilha o link no Facebook.
         */
        function compartilharFacebook() {
            const link = document.getElementById('linkGerado').value;
            const evento = document.getElementById('eventoInput').value;
            const nome = document.getElementById('nomeInput').value;

            // O Facebook Share Link permite que o usu√°rio adicione uma mensagem antes de publicar.
            const quoteText = `Confira o cart√£o animado que ${nome} criou para o evento "${evento.toUpperCase()}"! √â lindo!`;
            
            // Link de inten√ß√£o para Facebook Share (adicionamos a URL e uma pequena cita√ß√£o)
            const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(link)}&quote=${encodeURIComponent(quoteText)}`;
            
            window.open(facebookUrl, '_blank');
        }

        /**
         * Copia o link gerado para a √°rea de transfer√™ncia (usado no bot√£o COPIAR e no bot√£o Instagram).
         */
        function copiarLink() {
            const linkInput = document.getElementById('linkGerado');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // Para mobile
            
            navigator.clipboard.writeText(linkInput.value)
                .then(() => {
                    // Mensagem espec√≠fica para o Instagram
                    showMessage("‚úÖ LINK COPIADO! Cole o link diretamente na sua Bio do Instagram ou no Sticker de Link dos Stories!", 4000);
                })
                .catch(err => {
                    console.error('Erro ao copiar: ', err);
                    showMessage("‚ùå Erro ao copiar. Copie manualmente o link gerado acima.", 3000);
                });
        }


        /**
         * Decodifica os par√¢metros da URL e aplica ao formul√°rio/cart√£o.
         */
        function decodificarParametros() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.size === 0) {
                 // Se n√£o houver par√¢metros, inicializa com a data de Natal (como padr√£o)
                const hoje = new Date();
                const natal = new Date(hoje.getFullYear(), 11, 25);
                
                // Se o natal j√° passou, use o pr√≥ximo ano
                if (hoje > natal) {
                    natal.setFullYear(hoje.getFullYear() + 1);
                }
                
                // Formata para YYYY-MM-DD
                const dataFormatada = natal.toISOString().split('T')[0];
                document.getElementById('dataAlvoInput').value = dataFormatada;
                atualizarAlvo();
                return;
            }

            // Define os valores do formul√°rio
            document.getElementById('nomeInput').value = params.get('nome') || 'Seu Nome';
            document.getElementById('dataAlvoInput').value = params.get('data') || '';
            document.getElementById('eventoInput').value = params.get('evento') || 'FELIZ NATAL';
            document.getElementById('mensagemTexto').value = params.get('msg') || 'Que Deus te aben√ßoe com muita paz e alegria neste dia!';
            // Define URLs
            document.getElementById('urlsInput').value = params.get('urls') || '';
            
            // Define os estilos do formul√°rio
            document.getElementById('fonteInput').value = params.get('ft') || 'Inter, sans-serif';
            document.getElementById('corTitulo').value = params.get('ct') || '#004d99';
            document.getElementById('corMensagem').value = params.get('cm') || '#374151';
            document.getElementById('corBorda').value = params.get('cb') || '#c0c0c0';
            document.getElementById('corFundoCard').value = params.get('cfc') || '#ffffff';
            
            const corFundoBodyValue = params.get('cfb') || '#f0f4f7';
            document.getElementById('corFundoBody').value = corFundoBodyValue; // Define o input[type=color]
            
            document.getElementById('elementoPiscar').value = params.get('ep') || 'none';
            document.getElementById('corPiscar1').value = params.get('cp1') || '#ff0000';
            document.getElementById('corPiscar2').value = params.get('cp2') || '#00ff00';
            
            // Sincroniza o select de fundo com o valor carregado
            try {
                if (document.getElementById('fundoBodySelect').options) {
                    let found = false;
                    for (let i = 0; i < document.getElementById('fundoBodySelect').options.length; i++) {
                        if (document.getElementById('fundoBodySelect').options[i].value === corFundoBodyValue) {
                            document.getElementById('fundoBodySelect').value = corFundoBodyValue;
                            found = true;
                            break;
                        }
                    }
                    if (!found) {
                        // Se for uma cor customizada, apenas usa o input[type=color] e reseta o select para o padr√£o
                        document.getElementById('fundoBodySelect').value = document.getElementById('fundoBodySelect').options[0].value;
                    }
                }
            } catch (e) {
                console.warn("Erro ao sincronizar select de fundo:", e);
            }

            // Se houver qualquer par√¢metro na URL, assumimos o modo de visualiza√ß√£o.
            if (window.location.search) {
                document.body.classList.add('modo-visualizacao');
                showMessage("Modo de Visualiza√ß√£o Ativado!", 2000);
            }

            // Atualiza o cart√£o com os novos valores
            atualizarAlvo();
        }

        // Inicializa o cart√£o e exibe o pop-up
        window.onload = () => {
             decodificarParametros();
             exibirNovidadesAposAtraso();
        };
    </script>
</body>
</html>
